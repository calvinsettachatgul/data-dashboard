//! DataDashboard v0.0.1 ~~ https://github.com/dnajs/data-dashboard ~~ MIT License
var dataDashboard={widgets:[{code:"fin-rate-intraday",header:"Exchange rate intraday"},{code:"fin-rate-moving-avg",header:"Exchange rate moving average"},{code:"widget-a",header:"Widget A"},{code:"widget-c",header:"Widget C"},{code:"network-log",header:"Network log"}],panels:[{code:"space",header:"Space",widgets:["widget-a","widget-c"]},{code:"finance",header:"Finance",widgets:["fin-rate-moving-avg","fin-rate-intraday"]},{code:"panel-z",header:"The Z Panel",widgets:["fin-rate-intraday","widget-c"]},{code:"network",header:"Network",widgets:["network-log"]}],chartColor:{red:"rgba(255,  99, 132, 0.5)",blue:"rgba( 54, 162, 235, 0.5)",yellow:"rgba(255, 206,  86, 0.5)",green:"rgba( 75, 192, 192, 0.5)",purple:"rgba(153, 102, 255, 0.5)",orange:"rgba(255, 159,  64, 0.5)"}};dataDashboard.widget={},dataDashboard.util={addChartColors:function b(a){return a.forEach(function c(a,b){a.fill=!1,a.borderColor=dataDashboard.chartColors[b],a.backgroundColor=dataDashboard.chartColors[b]}),a},spinnerStart:function d(a){var b=a.addClass("waiting").find(">widget-spinner"),c=b.length?b:function b(){return library.ui.makeIcons($("<widget-spinner><i data-icon=yin-yang class=fa-spin>")).appendTo(a)}();return c.hide().fadeIn().parent()},spinnerStop:function b(a){return a.removeClass("waiting").find(">widget-spinner").fadeOut().parent()}},dataDashboard.network={logEvent:function g(){for(var a=50,b=3,c=dataDashboard.network.getLog(),d=arguments.length,e=Array(d),f=0;f<d;f++)e[f]=arguments[f];for(e[b]=new URL(e[b]).hostname,c.push(e);c.length>a;)c.shift();localStorage.setItem("network-log",JSON.stringify(c))},getLog:function a(){return JSON.parse(localStorage.getItem("network-log")||"[]")}},dataDashboard.controller={showPanel:function b(a){a.find(">dashboard-widgets").children().each(function f(a,b){var c=$(b),d=dna.getModel(c);c.find(">widget-body").remove(),c.append(dna.clone(d.code,{}));var e=dataDashboard.widget[dna.util.toCamel(d.code)];if(!e)throw Error("DataDashboard - Widget controller missing: "+d.code);e.show(c)})},setup:function b(){fetchJson.enableLogger(dataDashboard.network.logEvent);dataDashboard.chartColors=Object.keys(dataDashboard.chartColor).map(function b(a){return dataDashboard.chartColor[a]}),dataDashboard.widgetsMap=dna.array.toMap(dataDashboard.widgets);var a=function(a){return a.map(function(a){return dataDashboard.widgetsMap[a]})};dataDashboard.panels.forEach(function(b){return b.widgetList=a(b.widgets)}),library.ui.autoDisableButtons();$(function a(){dna.clone("dashboard-menu-item",dataDashboard.panels),dna.clone("dashboard-panel",dataDashboard.panels)})}},dataDashboard.controller.setup(),dataDashboard.widget.finRateIntraday={show:function c(a){var b=function(a){var b=a["Meta Data"],c=a["Time Series FX (5min)"],d=Object.keys(c).sort();return{title:b["1. Information"],subtitle:b["2. From Symbol"]+"/"+b["3. To Symbol"]+" "+b["4. Last Refreshed"],labels:d.map(function(a){return a.substr(11,5)}),lows:d.map(function(a){return parseFloat(c[a]["3. low"])}),highs:d.map(function(a){return parseFloat(c[a]["2. high"])})}};dataDashboard.util.spinnerStart(a),fetchJson.get("https://www.alphavantage.co/query",{function:"FX_INTRADAY",from_symbol:"EUR",to_symbol:"USD",interval:"5min",outputsize:"full",apikey:"demo"}).then(function g(c){var d=b(c),e=[{label:"Low",data:d.lows},{label:"High",data:d.highs}],f={type:"line",data:{labels:d.labels,datasets:dataDashboard.util.addChartColors(e)},options:{maintainAspectRatio:!1,title:{display:!0,text:[d.title,d.subtitle]}}};a.data().chart=new window.Chart(a.find("canvas"),f),dataDashboard.util.spinnerStop(a)})}},dataDashboard.widget.finRateMovingAvg={show:function c(a){var b=function(a){var b=a["Meta Data"],c=a["Technical Analysis: SMA"],d=Object.keys(c).sort();return{title:b["2: Indicator"],subtitle:b["3: Last Refreshed"],set:b["1: Symbol"],labels:d,values:d.map(function(a){return parseFloat(c[a].SMA)})}};dataDashboard.util.spinnerStart(a),fetchJson.get("https://www.alphavantage.co/query",{function:"SMA",symbol:"USDEUR",interval:"weekly",time_period:10,series_type:"open",apikey:"demo"}).then(function g(c){var d=b(c),e={label:d.set,data:d.values,borderColor:dataDashboard.chartColor.purple,backgroundColor:dataDashboard.chartColor.purple},f={type:"line",data:{labels:d.labels,datasets:[e]},options:{maintainAspectRatio:!1,title:{display:!0,text:[d.title,d.subtitle]}}};a.data().chart=new window.Chart(a.find("canvas"),f),dataDashboard.util.spinnerStop(a)})}},dataDashboard.widget.networkLog={show:function d(a){var b=dataDashboard.network.getLog().reverse();console.log(b);var c=a.find("figure table");c.append($("<tr><th>"+["Timestamp","HTTP","Method","Domain","Ok","Status","Text","Content"].join("</th><th>")+"</th></tr>"));b.forEach(function b(a){return c.append($("<tr><td>"+a.join("</td><td>")+"</td></tr>"))})}},dataDashboard.widget.widgetA={show:function d(a){var b=a.find("canvas"),c={type:"bar",data:{labels:Object.keys(dataDashboard.chartColor),datasets:[{label:"Things",data:[12,19,3,5,2,3],backgroundColor:dataDashboard.chartColors}]},options:{maintainAspectRatio:!1,scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}};a.data().chart=new window.Chart(b,c)}},dataDashboard.widget.widgetC={show:function b(a){dataDashboard.util.spinnerStart(a);window.setTimeout(function b(){return dataDashboard.util.spinnerStop(a)},5e3)}};
